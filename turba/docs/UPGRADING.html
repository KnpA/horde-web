<div class="document" id="upgrading-turba">
<h1 class="title">Upgrading Turba</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="field"><th class="docinfo-name">Last update:</th><td class="field-body">2011-01-24</td>
</tr>
<tr><th class="docinfo-name">Revision:</th>
<td>1.3.6.30</td></tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference external" href="mailto:turba&#64;lists.horde.org">turba&#64;lists.horde.org</a></td></tr>
</tbody>
</table>
<p>These are instructions to upgrade from earlier Turba versions. Please backup
your existing data before running any of the steps described below. You can't
use the updated data with your old Turba version anymore.</p>
<div class="section" id="upgrading-turba-from-2-3-x-to-2-3-6">
<h1>Upgrading Turba from 2.3.x to 2.3.6</h1>
<div class="section" id="new-experimental-sql-share-driver-support">
<h2>New Experimental SQL Share Driver Support</h2>
<p>A new, better scaling, experimental SQL Horde_Share driver has been added in
Horde 3.3.12. This driver offers significant performance improvements over the
existing SQL driver, but it has not received the same level of testing.  In
order to make use of this driver, you must be using Horde 3.3.12 or later.</p>
<p>Execute the provided SQL script to add the new tables needed for this driver,
e.g.:</p>
<pre class="literal-block">
mysql --user=root --password=&lt;MySQL-root-password&gt; &lt;db name&gt; &lt; scripts/upgrades/sharesng.sql
</pre>
<p>If you want to use the new SQL Share driver, you must also execute the
provided PHP script to migrate your existing share data to the new format:</p>
<pre class="literal-block">
php scripts/upgrades/convert_sql_shares_to_sqlng.php
</pre>
</div>
</div>
<div class="section" id="upgrading-turba-from-2-3-x-to-2-3-3">
<h1>Upgrading Turba from 2.3.x to 2.3.3</h1>
<div class="section" id="share-table-updates">
<h2>Share Table Updates</h2>
<p>The SQL script for PostgreSQL used a wrong column type for the share
tables. If you have many users or shares, this could cause an overrun at some
point. Execute the provided SQL script to update your database if you are
using the native SQL share driver on PostgresSQL:</p>
<pre class="literal-block">
psql &lt;db name&gt; &lt; scripts/upgrades/2.3_to_2.3.3.pgsql.sql
</pre>
</div>
</div>
<div class="section" id="upgrading-turba-from-2-2-1-to-2-3">
<h1>Upgrading Turba from 2.2.1 to 2.3</h1>
<div class="section" id="id1">
<h2>Share Table Updates</h2>
<p>Some fields in the SQL share driver tables have been changed. Execute the
provided SQL script to update your database if you are using the native SQL
share driver:</p>
<pre class="literal-block">
mysql --user=root --password=&lt;MySQL-root-password&gt;  &lt;db name&gt; &lt; scripts/upgrades/2.2.1_to_2.3.sql
</pre>
</div>
<div class="section" id="new-fields">
<h2>New fields</h2>
<p>Examples for a few new fields have been added to
<tt class="docutils literal">config/attributes.php.dist</tt> and <tt class="docutils literal">config/sources.php.dist</tt>. These field
require Horde 3.3 or later though, so they are disabled by default. If you
update your <tt class="docutils literal">attributes.php</tt> and <tt class="docutils literal">sources.php</tt> files and are using a
sufficiently recent Horde version, you may want to uncomment those
examples. These are the <tt class="docutils literal">photo</tt>, <tt class="docutils literal">phototype</tt>, <tt class="docutils literal">logo</tt>, <tt class="docutils literal">logotype</tt>,
<tt class="docutils literal">pgpPublicKey</tt> and <tt class="docutils literal">smimePublicKey</tt> fields.</p>
</div>
</div>
<div class="section" id="upgrading-to-turba-2-2">
<h1>Upgrading to Turba 2.2</h1>
<p>These are notes on upgrading from Turba 2.1.x to Turba 2.2.x.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">These upgrade instructions assume that you are upgrading from
at least Turba 2.1.  If you have an older version of Turba,
follow the upgrade steps described in <a class="reference internal" href="#upgrading-to-turba-2-1">Upgrading to Turba 2.1</a>
first.</p>
</div>
<div class="section" id="new-default-schema">
<h2>New Default Schema</h2>
<p>The default database address book schema has been changed to better match
other address book applications and to ease synchronization with those.</p>
<p>You can still use your old address book schema without any restrictions, but
if you want to migrate existing address books to the new default scheme, you
can use the provided upgrade script. This script assumes that you use the old
default schema from Turba 2.1 and doesn't permanently change any data unless
you edit it.</p>
<p>To run the script you have to open it in any text editor and change the three
variables at the top of the script <tt class="docutils literal">$db_user</tt>, <tt class="docutils literal">$db_pass</tt> and
<tt class="docutils literal">$db_table</tt> to fit your current Turba installation. You can then run the
script to see how the data //would// be changed:</p>
<pre class="literal-block">
php scripts/upgrades/2.1_to_2.2_sql_schema.php
</pre>
<p>If you are happy with the results, you can edit the script again and change
the <tt class="docutils literal">$for_real</tt> variable:</p>
<pre class="literal-block">
$for_real = true;
</pre>
<p>As always make sure you have a recent backup before running the script once
more, this time the changes will be permanent. Don't forget to update your
configuration files or to re-create them from the <tt class="docutils literal">.php.dist</tt> examples.</p>
<p>A few advanced attribute definitions have been commented out in
<tt class="docutils literal">config/attributes.php</tt> by default because they require Horde 3.2 or later
to be installed. If you have a sufficiently recent Horde version you can
uncomment those lines in <tt class="docutils literal">attributes.php</tt>.</p>
<p>As part of the new default schema, the various address fields have been split
into individual fields (such as homeStreet, homeProvince etc...). If you still
wish to display an individual composite address field (which will give you the
map links) you must add a composite field (such as homeAddress). There is an
example entry in the sources.php.dist file.</p>
<p>The new schema also uses the &quot;phone&quot; field type that has been introduced with
Horde 3.2. If you still run earlier Horde versions, change the phone field
types in <tt class="docutils literal">attributes.php</tt> to anything that fits your needs, e.g &quot;cellphone&quot;
or &quot;text&quot;.</p>
</div>
<div class="section" id="new-beta-sql-share-driver-support">
<h2>New Beta SQL Share Driver Support</h2>
<p>A new beta-level SQL Horde_Share driver has been added in Horde 3.2. This
driver offers significant performance improvements over the existing Datatree
driver but it has not received the same level of testing, thus the beta
designation.  In order to make use of this driver, you must be running Horde
3.2-RC3 or later. To add the new SQL tables for this driver, execute the sql
script <tt class="docutils literal">2.1_to_2.2_add_sql_share_tables</tt> that is appropriate for your
RDBMS. You then must execute the <tt class="docutils literal">convert_datatree_shares_to_sql.php</tt>
upgrade script to migrate your existing share data.  Both of these scripts can
be found in the <tt class="docutils literal">scripts/upgrades</tt> folder.</p>
</div>
<div class="section" id="flattened-horde-shares">
<h2>Flattened Horde Shares</h2>
<p>Shared address books are now stored in a flat namespace in order
to remove dependency on the hierarchal properties of the Horde_Share api.  You
must run the upgrade script <tt class="docutils literal"><span class="pre">scripts/upgrades/2007-06-17_flatten_shares.php</span></tt>.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">You must run these scripts BEFORE any user logs in to your
upgraded installation to avoid the creation of any duplicate
shares.</p>
</div>
<p>All user preferences related to address books will be checked and updated by
Turba transparently during each user's first login after the update.</p>
<p>Additionally, if you are currently using the configuration setting,
<tt class="docutils literal">Name of Client Address Book</tt> and have it set to a share enabled source, you
will most likely have to change the entry.  The correct share key to enter here
is the share name and can be found by browsing the datatree via the
administration UI if using datatree shares, or by looking in the turba_shares
table if using SQL based shares.</p>
</div>
<div class="section" id="imsp-driver-and-share-support">
<h2>IMSP Driver and Share Support</h2>
<p>Share support has been added to the IMSP driver.  This support requires at
least a Horde 3.2 install.  With this change, any IMSP address books the user
has rights to will be represented internally as a Horde share.  Permissions
changed on the share will be reflected back to the IMSP server.  If you set
the configuration setting <tt class="docutils literal">Name of source for creating new shares</tt> to
<tt class="docutils literal">imsp</tt> then any shares created by the user will result in a new IMSP address
book being created on the IMSP server.  Likewise, any IMSP address book
deleted in Turba will be removed from the IMSP server.</p>
<p>To enable this support, make sure you are using at least Horde 3.2, set the
<tt class="docutils literal">use_shares</tt> attribute to true, and uncomment the IMSP
<tt class="docutils literal">_horde_hook_share_*</tt> functions in <tt class="docutils literal">horde/config/hooks.php</tt>.</p>
<p>With this change, the <tt class="docutils literal">IMSP Address Book Administration</tt> option page has
been removed, as the creation/deletion of address books is now handled with
shares.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">IMSP contacts contained in contact groups that are not from an
IMSP source may not be visible within that group when migrating
an IMSP source to a share.</p>
</div>
</div>
<div class="section" id="application-hooks">
<h2>Application Hooks</h2>
<p>All hooks that are specific to Turba have been moved from the
<tt class="docutils literal">horde/config/hooks.php</tt> file. Move your existing Turba Hooks from there to
<tt class="docutils literal">turba/config/hooks.php</tt>.</p>
</div>
</div>
<div class="section" id="upgrading-to-turba-2-1">
<h1>Upgrading to Turba 2.1</h1>
<p>These are notes on upgrading from Turba 2.0.x to Turba 2.1.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">These upgrade instructions assume that you are upgrading from
at least Turba 2.0.  If you have an older version of Turba,
follow the upgrade steps described in <a class="reference internal" href="#upgrading-to-turba-2-0">Upgrading to Turba 2.0</a>
first.</p>
</div>
<div class="section" id="synchronization-support">
<h2>Synchronization Support</h2>
<p>Synchronization with SyncML capable devices is possible now if you have at
least Horde 3.1.  You need to create a History backend with
<tt class="docutils literal">horde/scripts/sql/horde_histories.sql</tt> to allow synchronization.  You also
need to create default history entries for existing contacts by running the
script <tt class="docutils literal">scripts/upgrades/create_default_histories.php</tt>.</p>
</div>
<div class="section" id="new-hook-parameters">
<h2>New Hook Parameters</h2>
<p>The <tt class="docutils literal">_turba_hook_encode_{attribute}</tt> and <tt class="docutils literal">_turba_hook_decode_{attribute}</tt>
functions are now passed an additional parameter - the object that is being
loaded/saved. This enables you to create more powerful custom hooks that build
a field from several other field's values (the opposite of composite fields),
or otherwise modify a value based on other properties of the object.</p>
</div>
<div class="section" id="share-support">
<h2>Share Support</h2>
<p>Share support has been added to Turba.  This allows the sharing, adding, and
deleting of addressbooks for those sources that support it.  Currently, this
is supported by the SQL driver.  With this change, the <tt class="docutils literal">public</tt> attribute of
the params array has been removed in favor of the <tt class="docutils literal">use_share</tt> attribute.  If
you are currently using a SQL source as a public source, you must run the
upgrade script <tt class="docutils literal">scripts/upgrades/public_to_horde_share.php</tt>.  Be sure to
read the script comments and backup all data before conversion.  This script
will create a new share that is viewable by all users.  If you choose not to
use shares, set the <tt class="docutils literal">use_shares</tt> attribute to <tt class="docutils literal">false</tt> and the SQL driver
will behave as in previous versions, that is, a seperate, private addressbook
for each user.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">If you are currently using two seperate <tt class="docutils literal">turba_objects</tt> tables
- one for personal address books and one for a public address
book, you should run the upgrade script on the public table,
then merge the public table into the private table and enable
share support on the private table.  There is no longer any
need for maintaining the two seperate tables. If you desire not
to enable share support, you may still use seperate tables and
set permissions via the administration interface.</p>
</div>
</div>
</div>
<div class="section" id="upgrading-to-turba-2-0">
<h1>Upgrading to Turba 2.0</h1>
<p>These are instructions to upgrade from Turba 1.2.x to Turba 2.0.  Please
backup your existing data before running any of the steps described below.
You can't use the updated data with your old Turba version anymore.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">These upgrade instructions assume that you are upgrading from
at least Turba 1.2.  If you have an older version of Turba,
follow the upgrade steps described in <a class="reference internal" href="#upgrading-to-turba-1-2">Upgrading to Turba 1.2</a>
first.</p>
</div>
<div class="section" id="sql-backends">
<h2>SQL Backends</h2>
<p>Four new fields have been added to the default SQL table layout, one being
mandatory.  The new <tt class="docutils literal">object_uid</tt> field provides a global unique ID to
objects.</p>
<p>Execute the provided SQL script to update your data to the new Turba version:</p>
<pre class="literal-block">
mysql --user=root --password=&lt;MySQL-root-password&gt; &lt;db name&gt; &lt; 1.2_to_2.0.sql
psql &lt;db name&gt; -f 1.2_to_2.0.sql
</pre>
</div>
<div class="section" id="history">
<h2>History</h2>
<p>The contacts history is now being maintained by the global Horde History
backend.  To create default history entries execute the provided PHP script:</p>
<pre class="literal-block">
php scripts/upgrades/create_default_histories.php
</pre>
</div>
</div>
<div class="section" id="upgrading-to-turba-1-2">
<h1>Upgrading to Turba 1.2</h1>
<p>These are instructions to upgrade from Turba 1.1 to Turba 1.2.  Please backup
your existing data before running any of the steps described below.  You will
no longer be able to use your data with older versions of Turba.</p>
<div class="section" id="id2">
<h2>SQL Backends</h2>
<p>The SQL schema for the SQL address book has changed. Please update your SQL
table to the new schema after you update to Turba 1.2.  The fields
<tt class="docutils literal">object_type</tt> and <tt class="docutils literal">object_members</tt> have been added (needed for
distribution lists) and the fields <tt class="docutils literal">object_homeaddress</tt>,
<tt class="docutils literal">object_workaddress</tt>, <tt class="docutils literal">object_homephone</tt>, <tt class="docutils literal">object_workphone</tt> and
<tt class="docutils literal">object_cellphone</tt> have changed to all lowercase.</p>
<p>If you are using a MySQL or PostgreSQL database you can also use the update
script available in <tt class="docutils literal">scripts/upgrades/1.1_to_1.2.sql</tt>.</p>
</div>
<div class="section" id="ldap-backends">
<h2>LDAP Backends</h2>
<p>The LDAP schema for the shared LDAP address book has changed. Please update
your LDAP directory to use the new schema after you update to Turba 1.2, and
also update <tt class="docutils literal">config/sources.php</tt> accordingly.</p>
<p>The <tt class="docutils literal">objectclass</tt> entry for LDAP address book definitions in
<tt class="docutils literal">config/sources.php</tt> is respected in Turba 1.2 but wasn't before, so you
should make sure that you use a correct setting here.</p>
</div>
<div class="section" id="imp-integration">
<h2>IMP Integration</h2>
<p>If you were using <a class="reference external" href="http://www.horde.org/imp/">IMP</a> 3.1 you should also upgrade to IMP 3.2; distribution
list support in Turba 1.2/IMP 3.2 is not compatible with how the contacts
window in IMP 3.1 worked. However, IMP 3.0 did not have this window, and will
probably play nicely with Turba 1.2.</p>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="http://cvs.horde.org/co.php/turba/docs/UPGRADING?onb=FRAMEWORK_3">View document source</a>.
Generated by <a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
