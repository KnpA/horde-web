<div class="document" id="horde-performance-guide">
<h1 class="title">Horde Performance Guide</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="field"><th class="docinfo-name">Last update:</th><td class="field-body">2010-03-07</td>
</tr>
<tr><th class="docinfo-name">Revision:</th>
<td>1.9.10.24</td></tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference" href="mailto:horde&#64;lists.horde.org">horde&#64;lists.horde.org</a></td></tr>
</tbody>
</table>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#linux-tuning" id="id1" name="id1">Linux Tuning</a></li>
<li><a class="reference" href="#webserver-php-tuning" id="id2" name="id2">Webserver/PHP tuning</a></li>
<li><a class="reference" href="#sending-mail" id="id3" name="id3">Sending Mail</a></li>
<li><a class="reference" href="#imap-tuning" id="id4" name="id4">IMAP tuning</a></li>
<li><a class="reference" href="#postgresql-tuning" id="id5" name="id5">PostgreSQL tuning</a></li>
<li><a class="reference" href="#mysql-tuning" id="id6" name="id6">MySQL tuning</a></li>
<li><a class="reference" href="#application-tuning" id="id7" name="id7">Application tuning</a></li>
</ul>
</div>
<p>Some tips on performance tuning systems for Horde.  This does not cover
hardware tuning or even low level system (network, filesystem, etc) tuning.</p>
<p>Don't apply the following tuning hints blindly.  Test your applications before
and after the changes under the conditions that are important for you.  For
some people it's more important to make them as fast as possible for a small
user base, others require the applications to scale well under a high load.
Some of these hints might even make the applications slower under certain
conditions or using a certain hardware.</p>
<div class="section">
<h1><a class="toc-backref" href="#id1" id="linux-tuning" name="linux-tuning">Linux Tuning</a></h1>
<ul class="simple">
<li>Recompile RPMS for your architecture (e.g. i586, i686, athlon, etc).
This applies most to your Apache, PHP, IMAP, and POP3 packages.</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="webserver-php-tuning" name="webserver-php-tuning">Webserver/PHP tuning</a></h1>
<ul>
<li><p class="first">Consider a PHP accelerator program.  See for example <a class="reference" href="http://www.zend.com/horde.php">The Zend Performance
Suite</a>, the <a class="reference" href="http://www.php.net/apc">Alternative PHP Cache</a>, <a class="reference" href="http://eaccelerator.net/">eAccelerator</a>, or <a class="reference" href="http://xcache.lighttpd.net/">XCache</a>.  These
accelerators speed up access by caching the compiled PHP code, eliminating
the need to recompile the code for every single page load. <strong>This is
probably the easiest way to improve the performance of Horde</strong>.</p>
</li>
<li><p class="first">Compile PHP with the <tt class="docutils literal"><span class="pre">--enable-inline-optimization</span></tt> option to generate the
fastest possible PHP executable.</p>
</li>
<li><p class="first">Use of the mcrypt PHP extension should significantly increase performance
while also increasing security.</p>
</li>
<li><p class="first">Enable PHP output compression in the Horde configuration. Do not enable
compression in the PHP configuration (i.e. in <tt class="docutils literal"><span class="pre">php.ini</span></tt>), because certain
scripts don't work well with compression and Horde takes care of disabling
compression conditionally.</p>
</li>
<li><p class="first">Keep the include path defined in <tt class="docutils literal"><span class="pre">php.ini</span></tt> as short as possible, with the
most frequently used library paths first.  You don't need to include the
local directory <tt class="docutils literal"><span class="pre">.</span></tt> because Horde always uses full paths instead of
relative paths.</p>
</li>
<li><p class="first">Use an optimized <tt class="docutils literal"><span class="pre">php.ini</span></tt>: start with <tt class="docutils literal"><span class="pre">php.ini-recommended</span></tt> in your PHP
dsitribution.</p>
</li>
<li><p class="first">Don't run PHP session garbage collection too often if using a slow storage
medium (like SQL). (See <tt class="docutils literal"><span class="pre">session.gc_probability</span></tt> in <tt class="docutils literal"><span class="pre">php.ini</span></tt>)</p>
</li>
<li><p class="first">If you have a large number of sessions and are using PHP's default file
based session handler, consider storing them in hashed directory levels.
(See <tt class="docutils literal"><span class="pre">session.save_path</span></tt> at <a class="reference" href="http://www.php.net/session">http://www.php.net/session</a>)</p>
</li>
<li><p class="first">Consider using a faster storage medium for sessions, such as a tmpfs
(if storing sessions locally) or memcache (for storing session information
that can be accessed by multiple servers).</p>
</li>
<li><p class="first">Only load as many Apache and PHP extensions as needed (to reduce memory
usage).</p>
</li>
<li><p class="first">Use statically compiled Apache modules, including the PHP module.</p>
</li>
<li><p class="first">Use compiler optimizations (--prefer-non-pic, -O3, -march -mcpu, -msse,
-mmmx, -mfpmath=sse, etc.)</p>
</li>
<li><p class="first">If using SSL with a large site, consider a hardware SSL accelerator.</p>
</li>
<li><p class="first">Use shared memory for the Apache SSL cache if possible.</p>
</li>
<li><p class="first">To improve caching of static content if accessing Apache SSL with Internet
Explorer, try setting longer expiration periods:</p>
<pre class="literal-block">
ExpiresActive On
ExpiresByType image/png &quot;now plus 1 month&quot;
ExpiresByType image/gif &quot;now plus 1 month&quot;
ExpiresByType text/javascript &quot;now plus 1 month&quot;
ExpiresByType application/x-javascript &quot;now plus 1 month&quot;
ExpiresByType text/css &quot;now plus 1 month&quot;
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">You must compile the <tt class="docutils literal"><span class="pre">mod_expires</span></tt> extension into Apache in
order to use these directives.</p>
</div>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last">This might cause problems if you upgrade Horde and the users'
browsers still use the old file versions.</p>
</div>
</li>
<li><p class="first">Disable DNS lookups in your Apache logging, or use a caching DNS server on
the web server host.</p>
</li>
<li><p class="first">Enable Apache keepalives.</p>
</li>
<li><p class="first">You can configure Horde to serve all images, style sheets and/or static
javascript files from a different server. This could be a very lightweight
server without PHP (and other CGI modules) builtin. If using SSL to serve
all pages, the images/js server will also have to serve SSL content or else
browsers will complain about non-secure content in a secure page. Good
lightweight servers that support SSL include <a class="reference" href="http://www.lighttpd.net/">lighttpd</a> and <a class="reference" href="http://hiawatha.leisink.org/">Hiawatha</a>. If
using a Horde installation that doesn't use SSL (or only uses SSL for
logins), good choices for servers include <a class="reference" href="http://www.acme.com/software/thttpd/">thttpd</a> or <a class="reference" href="http://www.boa.org/">Boa</a>. You need to set
the <tt class="docutils literal"><span class="pre">themesuri</span></tt> and/or <tt class="docutils literal"><span class="pre">jsuri</span></tt> parameters in <tt class="docutils literal"><span class="pre">config/registry.php</span></tt> for
all applications and copy all <tt class="docutils literal"><span class="pre">themes</span></tt> and/or <tt class="docutils literal"><span class="pre">js</span></tt> directories in the
same directory layout to the other server.</p>
</li>
<li><p class="first">Your webserver should use Expires headers to make sure static content can
be cached on the user's browser.  For example, to make lighttpd set an
expiration date on all graphics, javascript files, and stylesheets, add
the following to <tt class="docutils literal"><span class="pre">lighttpd.conf</span></tt>:</p>
<pre class="literal-block">
$HTTP[&quot;url&quot;] =~ &quot;\.(jpg|gif|png|js|css)$&quot; {
    expire.url = ( &quot;&quot; =&gt; &quot;access 1 months&quot; )
}
</pre>
</li>
<li><p class="first">Enable caching in horde. Several applications make heavy use of caching and,
if enabled, you will see a significant increase in performance.</p>
</li>
<li><p class="first">For applications that support it (this includes IMP as of version 4.2 and
DIMP), enable compression of javascript and CSS. See <a class="reference" href="http://yuiblog.com/blog/2006/11/28/performance-research-part-1/">Yahoo's Analysis</a>
which concludes that &quot;[r]educing the number of HTTP requests has the biggest
impact on reducing response time&quot;. NOTE: Horde caching is required to enable
this feature.</p>
</li>
<li><p class="first">It is highly recommended to install the lzf PECL module to activate
compression for certain Horde data (especially in IMP).  lzf is a tiny
module that does real-time compression.  The lzf documentation states that on
modern CPUs, compression is as fast as an (unoptimized) memcpy action, making
the compression essentially 'free' when compared to uncompressed data.
lzf can be installed via PECL (see INSTALL).</p>
</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id3" id="sending-mail" name="sending-mail">Sending Mail</a></h1>
<ul class="simple">
<li>Generally using a local sendmail command to send mail will result in better
peformance than using a SMTP connection.</li>
<li>Some MTA servers may be faster or more efficient than others.  Consider
switching to a faster format if needed.</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id4" id="imap-tuning" name="imap-tuning">IMAP tuning</a></h1>
<ul class="simple">
<li>Consider an IMAP proxy for more persistent connections.  Some IMAP proxies
are <a class="reference" href="http://www.imapproxy.org/">up-imapproxy</a> and <a class="reference" href="http://www.vergenet.net/linux/perdition/">Perdition</a>.  To make sense, the proxy
should be installed on the server running Horde, and this server needs
enough CPU power to handle the additional load.  If using up-imapproxy,
make sure SELECT caching is turned off.</li>
<li>Some IMAP servers (or IMAP mailbox store formats) perform better than
others.  Consider switching to a faster format if needed.</li>
<li>Follow the IMAP servers' performance hints:<ul>
<li>Cyrus: <a class="reference" href="http://asg.web.cmu.edu/cyrus/download/imapd/install-perf.html">http://asg.web.cmu.edu/cyrus/download/imapd/install-perf.html</a></li>
<li>Dovecot: <a class="reference" href="http://wiki.dovecot.org/PerformanceTuning">http://wiki.dovecot.org/PerformanceTuning</a></li>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id5" id="postgresql-tuning" name="postgresql-tuning">PostgreSQL tuning</a></h1>
<ul class="simple">
<li>Do a <tt class="docutils literal"><span class="pre">VACUUM</span></tt> command periodically to tune your database.</li>
<li>Increase <tt class="docutils literal"><span class="pre">shared_buffers</span></tt> and <tt class="docutils literal"><span class="pre">sort_mem</span></tt> memory settings.
NB: <tt class="docutils literal"><span class="pre">sort_mem</span></tt> is now called <tt class="docutils literal"><span class="pre">work_mem</span></tt> in newer versions.</li>
<li>If web server and database is on the same unix host, use unix sockets
instead of network connections for database access.</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id6" id="mysql-tuning" name="mysql-tuning">MySQL tuning</a></h1>
<ul>
<li><p class="first">If web server and database is on the same unix host, use unix sockets
instead of network connections for database access.</p>
</li>
<li><p class="first">Enable mysql query cache if you have sufficient RAM.  Edit your <tt class="docutils literal"><span class="pre">my.cnf</span></tt>
file and add the following to the <tt class="docutils literal"><span class="pre">[mysqld]</span></tt> section (change the memory
size to meet your needs):</p>
<pre class="literal-block">
set-variable = query_cache_size=128M
</pre>
</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id7" id="application-tuning" name="application-tuning">Application tuning</a></h1>
<ul class="simple">
<li>Horde 3.2+ and some applications have better performing drivers for Groups,
Permissions and Shares than the original DataTree drivers. If you upgraded
from older Horde versions, you can change the driver for those systems to
&quot;SQL&quot; in the Horde configuration interface. You also have to run the
according <tt class="docutils literal"><span class="pre">convert_datatree_*.php</span></tt> scripts in <tt class="docutils literal"><span class="pre">horde/scripts/upgrades/</span></tt>
and the applications' <tt class="docutils literal"><span class="pre">scripts/upgrades/</span></tt> directories.</li>
<li>Some applications contain advanced features that might have a certain impact
on the performance.  These features can usually be turned off in the
application's configuration and are explicitly described as being a
performance hit in the configuration web frontend.</li>
</ul>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="http://cvs.horde.org/co.php/horde/docs/PERFORMANCE?onb=FRAMEWORK_3">View document source</a>.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
